var path = require('path');
var express = require('express');
var app = express();
var server = app.listen(8081);
var io = require('socket.io').listen(server);
var watch = require('gulp-watch');

var config = {
    dataPath: path.join(__dirname, '../data', 'status.json'),
    watchConf: {}
};

app.get('/', function (req, res) {
    res.send('sourcejs-contrib-status socket.io server');
});

watch(config.dataPath, config.watchConf, function (vinyl) {
    var rawContents;

    try {
        rawContents = JSON.parse(String(vinyl.contents));
    } catch (e) {}

    io.emit('status-update', rawContents);
});